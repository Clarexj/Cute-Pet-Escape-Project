# 任务3.2：实现核心UI界面(HUD) - Cocos Creator搭建步骤

**文档版本**：V3.2
**创建日期**：2025-10-02
**适用引擎**：Cocos Creator 3.x

---

## 📋 目录

1. [UI层级结构总览](#1-ui层级结构总览)
2. [创建Canvas根节点](#2-创建canvas根节点)
3. [搭建左上角团队成员状态UI](#3-搭建左上角团队成员状态ui)
4. [搭建正上方倒计时UI](#4-搭建正上方倒计时ui)
5. [搭建正上方矿石进度UI](#5-搭建正上方矿石进度ui)
6. [绑定UIManager脚本](#6-绑定uimanager脚本)
7. [测试与调试](#7-测试与调试)
8. [常见问题排查](#8-常见问题排查)

---

## 1. UI层级结构总览

完成后的UI层级结构如下：

```
Canvas (2D UI根节点)
├── HUD (核心UI容器)
│   ├── TopPanel (顶部面板)
│   │   ├── TimerLabel (倒计时)
│   │   └── OreProgressLabel (矿石进度)
│   │
│   └── TeamStatusPanel (团队状态面板)
│       ├── TeamMember1 (成员1状态方块)
│       ├── TeamMember2 (成员2状态方块)
│       ├── TeamMember3 (成员3状态方块)
│       └── TeamMember4 (成员4状态方块)
│
└── UIManager组件 (挂载在Canvas上)
```

---

## 2. 创建Canvas根节点

### 步骤2.1：创建Canvas

1. 在**Hierarchy（层级）**面板中，右键点击空白处
2. 选择 **创建 > 2D对象 > Canvas**
3. Canvas节点会自动创建，并包含一个Camera子节点

### 步骤2.2：配置Canvas

1. 选中Canvas节点
2. 在**Inspector（属性检查器）**面板中，找到**Canvas**组件
3. 配置以下属性：
   - **Design Resolution（设计分辨率）**：`1920 x 1080`（推荐）
   - **Fit Height（适配高度）**：勾选 ✅
   - **Fit Width（适配宽度）**：勾选 ✅

### 步骤2.3：配置UITransform

Canvas节点的**UITransform**组件会自动配置：
- **Width**：1920
- **Height**：1080
- **Anchor X**：0.5
- **Anchor Y**：0.5

---

## 3. 搭建左上角团队成员状态UI

### 步骤3.1：创建团队状态面板容器

1. 右键点击**Canvas**节点
2. 选择 **创建 > 创建空节点**
3. 命名为 `TeamStatusPanel`

### 步骤3.2：配置TeamStatusPanel位置

1. 选中`TeamStatusPanel`节点
2. 在**Inspector**面板中，配置**UITransform**：
   - **Anchor Preset（锚点预设）**：点击左上角预设（Left-Top）
   - **Position X**：`100`
   - **Position Y**：`-100`
   - **Width**：`400`
   - **Height**：`80`

### 步骤3.3：创建团队成员状态方块（重复4次）

**为每个逃生者创建一个状态方块（TeamMember1 ~ TeamMember4）**

#### 3.3.1 创建第一个方块（TeamMember1）

1. 右键点击`TeamStatusPanel`
2. 选择 **创建 > 2D对象 > Sprite**
3. 命名为 `TeamMember1`

#### 3.3.2 配置TeamMember1

**UITransform配置**：
- **Position X**：`0`
- **Position Y**：`0`
- **Width**：`60`
- **Height**：`60`

**Sprite配置**：
- **SpriteFrame**：使用内置白色方块（后面步骤会说明）
- **Color**：`绿色 (0, 255, 0, 255)` - 初始颜色，代码会自动修改
- **Type**：`Simple`

#### 3.3.3 使用内置白色方块作为SpriteFrame

1. 在**Assets（资源）**面板中，找到 `internal/default_ui/`
2. 找到 `default_sprite_splash` 或 `ui_sprite_default`
3. 将其拖拽到TeamMember1的**Sprite > SpriteFrame**属性上

#### 3.3.4 创建第2、3、4个方块

重复步骤3.3.1-3.3.3，创建`TeamMember2`、`TeamMember3`、`TeamMember4`

**位置配置**（水平排列）：
| 节点名 | Position X | Position Y |
|--------|-----------|-----------|
| TeamMember1 | 0 | 0 |
| TeamMember2 | 80 | 0 |
| TeamMember3 | 160 | 0 |
| TeamMember4 | 240 | 0 |

**最终效果**：4个绿色方块水平排列在左上角

---

## 4. 搭建正上方倒计时UI

### 步骤4.1：创建顶部面板容器

1. 右键点击**Canvas**节点
2. 选择 **创建 > 创建空节点**
3. 命名为 `TopPanel`

### 步骤4.2：配置TopPanel位置

1. 选中`TopPanel`节点
2. 配置**UITransform**：
   - **Anchor Preset**：点击顶部中央预设（Top-Center）
   - **Position X**：`0`
   - **Position Y**：`-50`
   - **Width**：`400`
   - **Height**：`100`

### 步骤4.3：创建倒计时Label

1. 右键点击`TopPanel`
2. 选择 **创建 > 2D对象 > Label**
3. 命名为 `TimerLabel`

### 步骤4.4：配置TimerLabel

**UITransform配置**：
- **Position X**：`0`
- **Position Y**：`0`
- **Width**：`200`
- **Height**：`60`

**Label配置**：
- **String**：`05:00`（初始显示文本）
- **Font Size**：`48`
- **Color**：`白色 (255, 255, 255, 255)`
- **Horizontal Align（水平对齐）**：`Center`
- **Vertical Align（垂直对齐）**：`Center`
- **Overflow（溢出处理）**：`None`

**可选：使用自定义字体**
1. 导入TTF字体文件到`assets/fonts/`
2. 将字体文件拖拽到Label组件的**Font**属性上

---

## 5. 搭建正上方矿石进度UI

### 步骤5.1：创建矿石进度Label

1. 右键点击`TopPanel`
2. 选择 **创建 > 2D对象 > Label**
3. 命名为 `OreProgressLabel`

### 步骤5.2：配置OreProgressLabel

**UITransform配置**：
- **Position X**：`0`
- **Position Y**：`-60`（位于倒计时下方）
- **Width**：`150`
- **Height**：`50`

**Label配置**：
- **String**：`0/8`（初始显示文本）
- **Font Size**：`36`
- **Color**：`白色 (255, 255, 255, 255)`
- **Horizontal Align**：`Center`
- **Vertical Align**：`Center`
- **Overflow**：`None`

---

## 6. 绑定UIManager脚本

### 步骤6.1：添加UIManager组件

1. 选中**Canvas**节点
2. 在**Inspector**面板底部，点击 **添加组件 > 自定义脚本 > UIManager**
3. UIManager组件会出现在Inspector面板中

### 步骤6.2：绑定倒计时Label

1. 在UIManager组件中，找到**Timer Label**属性
2. 将**Hierarchy**中的`TimerLabel`节点拖拽到此属性框中

### 步骤6.3：绑定矿石进度Label

1. 找到**Ore Progress Label**属性
2. 将`OreProgressLabel`节点拖拽到此属性框中

### 步骤6.4：绑定团队成员状态方块

1. 找到**Team Member Sprites**属性（这是一个数组）
2. 点击数组右侧的 `+` 按钮，添加4个元素（Size设置为4）
3. 依次拖拽团队成员节点的**Sprite组件**到数组元素中：
   - **Element 0**：拖拽`TeamMember1`节点到此，选择其**Sprite**组件
   - **Element 1**：拖拽`TeamMember2`节点到此，选择其**Sprite**组件
   - **Element 2**：拖拽`TeamMember3`节点到此，选择其**Sprite**组件
   - **Element 3**：拖拽`TeamMember4`节点到此，选择其**Sprite**组件

**重要提示**：拖拽时需要选择节点的**Sprite组件**，而非节点本身！

### 步骤6.5：配置UIManager其他属性

**自动查找选项**：
- **Auto Find Team Members**：✅ 勾选（自动查找场景中的逃生者）

**状态颜色配置**（可选，使用默认值即可）：
- **Normal Color**：绿色 `(0, 255, 0, 255)`
- **Caught Color**：橙色 `(255, 165, 0, 255)`
- **Hanged Color**：红色 `(255, 0, 0, 255)`
- **Eliminated Color**：灰色 `(128, 128, 128, 255)`

**调试选项**：
- **Enable Debug Log**：✅ 勾选（开发阶段推荐勾选，方便调试）

### 步骤6.6：绑定TeamStatusContainer（可选）

1. 找到**Team Status Container**属性
2. 将`TeamStatusPanel`节点拖拽到此属性框中
3. （此属性为可选，主要用于后续扩展功能）

---

## 7. 测试与调试

### 步骤7.1：检查场景中的逃生者节点

确保场景中有4个逃生者节点，并且节点命名包含"Survivor"关键词：
- `Survivor1` ✅
- `Survivor2` ✅
- `Survivor3` ✅
- `Survivor4` ✅

**如果节点命名不符合**，修改为包含"Survivor"的名称，或修改UIManager.ts代码中的筛选逻辑。

### 步骤7.2：检查逃生者是否挂载CharacterState组件

1. 选中每个逃生者节点
2. 确认**Inspector**中有**CharacterState**组件
3. 如果缺失，添加组件：**添加组件 > 自定义脚本 > CharacterState**

### 步骤7.3：检查GameManager是否存在

1. 确保场景中有**GameManager**节点
2. 该节点挂载了**GameManager**组件
3. 如果缺失，创建空节点并添加GameManager组件

### 步骤7.4：运行游戏测试

1. 点击编辑器顶部的 **播放按钮（▶️）** 运行游戏
2. 观察控制台输出：
   ```
   [UIManager] HUD UI管理器初始化
   [UIManager] 绑定团队成员 0: Survivor1
   [UIManager] 绑定团队成员 1: Survivor2
   [UIManager] 绑定团队成员 2: Survivor3
   [UIManager] 绑定团队成员 3: Survivor4
   [UIManager] 成功绑定 4 个团队成员UI
   [UIManager] HUD UI初始化完成
   ```

3. 观察UI显示：
   - ✅ 左上角显示4个绿色方块
   - ✅ 正上方显示倒计时`05:00`
   - ✅ 倒计时下方显示矿石进度`0/8`

### 步骤7.5：测试动态更新

**测试倒计时**：
- 游戏运行后，倒计时应该每秒递减：`05:00 -> 04:59 -> 04:58 ...`
- 倒计时 < 60秒时，文字变红色

**测试矿石进度**：
1. 让角色拾取矿石
2. 观察矿石进度更新：`0/8 -> 1/8 -> 2/8 ...`
3. 当达到`8/8`时，文字变绿色

**测试团队成员状态**：
1. 让追捕者抓住一个逃生者
2. 观察对应方块变为橙色（被抓状态）
3. 将逃生者挂在笼子上
4. 观察对应方块变为红色（被挂起状态）
5. 让倒计时结束或救援次数耗尽
6. 观察对应方块变为灰色（淘汰状态）

---

## 8. 常见问题排查

### 问题1：团队成员状态方块没有显示

**可能原因**：
1. TeamMemberSprites数组未正确绑定
2. 场景中逃生者节点命名不包含"Survivor"

**解决方案**：
1. 检查UIManager的Team Member Sprites数组是否有4个元素
2. 确认每个元素都绑定了对应的Sprite组件（而非Node）
3. 检查逃生者节点命名是否符合规范

**调试方法**：
- 运行游戏后查看Console输出
- 如果看到`场景中未找到逃生者节点`，说明命名不符合

---

### 问题2：倒计时或矿石进度不更新

**可能原因**：
1. Label属性未绑定
2. GameManager未正确初始化

**解决方案**：
1. 重新绑定TimerLabel和OreProgressLabel
2. 确认场景中有GameManager节点
3. 检查Console是否有错误信息：`[UIManager] GameManager未找到！`

---

### 问题3：团队成员状态方块颜色不变化

**可能原因**：
1. CharacterState组件未挂载到逃生者节点
2. 状态回调未正确注册

**解决方案**：
1. 检查每个逃生者节点是否有CharacterState组件
2. 运行游戏后查看Console，应该有以下输出：
   ```
   [UIManager] 绑定团队成员 0: Survivor1
   ```
3. 当角色状态变化时，应该看到：
   ```
   [UIManager] Survivor1 状态变化: normal -> caught
   ```

**调试方法**：
- 在UIManager中勾选`Enable Debug Log`
- 手动调用角色的状态切换方法，观察Console输出

---

### 问题4：UI元素位置错误或看不见

**可能原因**：
1. Canvas分辨率设置错误
2. UITransform的Anchor设置错误
3. Position值设置错误

**解决方案**：
1. 检查Canvas的Design Resolution是否为`1920 x 1080`
2. 检查每个UI元素的Anchor Preset是否正确：
   - TeamStatusPanel → Left-Top
   - TopPanel → Top-Center
3. 确认Position值与文档一致

**调试方法**：
- 在Scene视图中切换到2D模式
- 检查UI元素是否在Canvas范围内
- 使用Gizmos显示Anchor和Position

---

### 问题5：拖拽节点到属性框时无法绑定

**可能原因**：
1. 拖拽的组件类型不匹配
2. 节点不在同一场景中

**解决方案**：
1. **Team Member Sprites**需要拖拽**Sprite组件**，不是Node！
   - 正确做法：拖拽节点后，在弹出菜单中选择"Sprite"组件
2. **Timer Label / Ore Progress Label**需要拖拽**Label组件**
   - 正确做法：拖拽节点后，在弹出菜单中选择"Label"组件

**操作技巧**：
- 拖拽节点到属性框后，会弹出组件选择菜单
- 选择正确的组件类型（Sprite / Label / Node）

---

### 问题6：Console显示"已存在实例，销毁当前节点"

**可能原因**：
- 场景中有多个GameManager节点

**解决方案**：
1. 删除多余的GameManager节点，只保留一个
2. GameManager使用单例模式，只能有一个实例

---

### 问题7：方块颜色始终是绿色

**可能原因**：
1. Sprite组件的Color属性被锁定
2. 代码中颜色设置未生效

**解决方案**：
1. 选中TeamMember节点，检查Sprite组件的Color属性
2. 取消勾选Color旁边的锁定图标（如果有）
3. 运行游戏后，手动修改角色状态，观察方块颜色变化

**测试代码**（在Console中运行）：
```typescript
// 获取UIManager实例
const canvas = cc.find('Canvas');
const uiManager = canvas.getComponent('UIManager');

// 打印团队成员状态
uiManager.debugPrintTeamStatus();
```

---

## 📌 配置检查清单

完成UI搭建后，请对照此清单检查：

### Canvas层级结构
- [ ] Canvas节点存在
- [ ] Canvas下有TeamStatusPanel和TopPanel
- [ ] TeamStatusPanel下有4个TeamMember子节点
- [ ] TopPanel下有TimerLabel和OreProgressLabel

### UIManager组件配置
- [ ] UIManager组件已添加到Canvas节点
- [ ] Timer Label已绑定到TimerLabel节点
- [ ] Ore Progress Label已绑定到OreProgressLabel节点
- [ ] Team Member Sprites数组Size为4
- [ ] 数组中4个元素都绑定了对应的Sprite组件
- [ ] Auto Find Team Members已勾选
- [ ] Enable Debug Log已勾选（开发阶段）

### 场景配置
- [ ] 场景中有4个逃生者节点（命名包含"Survivor"）
- [ ] 每个逃生者节点挂载了CharacterState组件
- [ ] 场景中有1个GameManager节点
- [ ] GameManager节点挂载了GameManager组件

### 运行测试
- [ ] 运行游戏无Console错误
- [ ] 左上角显示4个绿色方块
- [ ] 正上方显示倒计时（每秒更新）
- [ ] 倒计时下方显示矿石进度
- [ ] 角色状态变化时方块颜色正确更新

---

## 🎨 UI美化建议（可选）

### 添加背景面板

为TopPanel和TeamStatusPanel添加半透明黑色背景：

1. 在各Panel下创建Sprite子节点，命名为`Background`
2. 使用内置白色方块作为SpriteFrame
3. 设置Color为半透明黑色：`(0, 0, 0, 150)`
4. 调整Position和Size使其覆盖整个Panel
5. 在Hierarchy中将Background拖到Panel的第一个子节点（显示在最底层）

### 添加图标

为矿石进度Label添加矿石图标：

1. 导入矿石图标图片到`assets/textures/ui/`
2. 在OreProgressLabel左侧创建Sprite节点
3. 设置SpriteFrame为矿石图标
4. 调整大小为`40 x 40`

### 使用自定义字体

1. 下载免费字体（如阿里巴巴普惠体）
2. 导入TTF文件到`assets/fonts/`
3. 在Label组件的Font属性中选择自定义字体

---

## 📝 下一步工作

完成UI搭建后，可以继续以下任务：

1. **测试UI数据同步**：运行游戏，测试所有UI元素的实时更新
2. **添加更多UI元素**：逃脱人数显示、淘汰人数显示、游戏结束面板
3. **优化UI布局**：调整间距、对齐、颜色搭配
4. **添加UI动画**：倒计时闪烁、矿石进度填充动画、状态方块过渡动画

---

**文档生成时间**：2025-10-02
**脚本版本**：V3.2
**引擎要求**：Cocos Creator 3.x
**配置难度**：⭐⭐☆☆☆（中等）
