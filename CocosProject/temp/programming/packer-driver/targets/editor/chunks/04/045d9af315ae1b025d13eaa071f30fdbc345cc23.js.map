{"version":3,"sources":["file:///Users/clare/Desktop/%E5%89%8D%E5%93%A8AI%E5%B0%8F%E8%AF%BE/ClareProject/Cute-Pet-Escape-Project/CocosProject/assets/scripts/network/NetworkGameManager.ts"],"names":["_decorator","Component","director","ccclass","property","NetworkGameManager","client","room","localSessionId","onLoad","_instance","console","warn","node","destroy","addPersistRootNode","log","start","autoCreateRoom","scheduleOnce","initializeNetwork","Colyseus","error","Client","serverUrl","playerName","trim","generateRandomName","createRoom","characterType","create","roomName","sessionId","id","setupRoomEvents","joinRoom","roomId","joinById","state","players","onAdd","player","name","onPlayerJoined","onRemove","onPlayerLeft","onChange","onPlayerStateChanged","setupCustomMessages","onMessage","message","onOreCollectedNetwork","onPlayerCapturedNetwork","onPlayerHangedNetwork","onPlayerRescuedNetwork","onPlayerEscapedNetwork","onGameOverNetwork","sendPlayerMove","x","y","z","rotationY","isMoving","animationState","send","timestamp","Date","now","sendOreCollected","oreId","sendPlayerCaptured","targetSessionId","hunterSessionId","sendPlayerHanged","cageId","sendPlayerRescued","rescuerSessionId","sendPlayerEscaped","adjectives","nouns","adj","Math","floor","random","length","noun","num","getRoomId","getLocalSessionId","isConnected","getPlayerCount","size","getInstance","onDestroy","leave"],"mappings":"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","sourcesContent":["// æ–‡ä»¶å: NetworkGameManager.ts\n// åŠŸèƒ½: ç½‘ç»œæ¸¸æˆç®¡ç†å™¨ - ç»Ÿä¸€ç®¡ç†æ‰€æœ‰ç½‘ç»œåŠŸèƒ½ï¼ˆä»»åŠ¡4.1-4.4ï¼‰\n// è‡ªåŠ¨åœ¨GameSceneå¯åŠ¨æ—¶åˆ›å»º/åŠ å…¥æˆ¿é—´ï¼Œå¹¶åŒæ­¥æ‰€æœ‰æ¸¸æˆçŠ¶æ€\n\nimport { _decorator, Component, director } from 'cc';\nimport { NetworkManager } from './NetworkManager';\nconst { ccclass, property } = _decorator;\n\n// å£°æ˜Colyseuså…¨å±€å¯¹è±¡\ndeclare const Colyseus: any;\n\n@ccclass('NetworkGameManager')\nexport class NetworkGameManager extends Component {\n    @property\n    public serverUrl: string = 'ws://localhost:2567';\n\n    @property\n    public roomName: string = 'game_room';\n\n    @property\n    public autoCreateRoom: boolean = true; // è‡ªåŠ¨åˆ›å»ºæˆ¿é—´\n\n    @property\n    public playerName: string = ''; // ç©å®¶åç§°ï¼ˆç©ºåˆ™è‡ªåŠ¨ç”Ÿæˆï¼‰\n\n    @property\n    public characterType: string = 'survivor'; // è§’è‰²ç±»å‹: survivor æˆ– hunter\n\n    // Colyseuså®¢æˆ·ç«¯å’Œæˆ¿é—´\n    private client: any = null;\n    private room: any = null;\n    private localSessionId: string = '';\n\n    // å•ä¾‹\n    private static _instance: NetworkGameManager | null = null;\n\n    onLoad() {\n        // å•ä¾‹æ¨¡å¼\n        if (NetworkGameManager._instance) {\n            console.warn('[NetworkGameManager] å·²å­˜åœ¨å®ä¾‹ï¼Œé”€æ¯å½“å‰èŠ‚ç‚¹');\n            this.node.destroy();\n            return;\n        }\n        NetworkGameManager._instance = this;\n\n        // è·¨åœºæ™¯æŒä¹…åŒ–\n        director.addPersistRootNode(this.node);\n\n        console.log('[NetworkGameManager] ç½‘ç»œæ¸¸æˆç®¡ç†å™¨åˆå§‹åŒ–');\n    }\n\n    start() {\n        // è‡ªåŠ¨è¿æ¥å¹¶åˆ›å»ºæˆ¿é—´\n        if (this.autoCreateRoom) {\n            this.scheduleOnce(() => {\n                this.initializeNetwork();\n            }, 0.5); // å»¶è¿Ÿ0.5ç§’ï¼Œç¡®ä¿åœºæ™¯åŠ è½½å®Œæˆ\n        }\n    }\n\n    /**\n     * åˆå§‹åŒ–ç½‘ç»œè¿æ¥\n     */\n    private async initializeNetwork() {\n        try {\n            console.log('[NetworkGameManager] æ­£åœ¨åˆå§‹åŒ–ç½‘ç»œè¿æ¥...');\n\n            // åˆ›å»ºColyseuså®¢æˆ·ç«¯\n            if (typeof Colyseus === 'undefined') {\n                console.error('[NetworkGameManager] ColyseusæœªåŠ è½½ï¼è¯·æ£€æŸ¥colyseus.jsæ˜¯å¦æ­£ç¡®å¼•å…¥');\n                return;\n            }\n\n            this.client = new Colyseus.Client(this.serverUrl);\n            console.log(`[NetworkGameManager] Colyseuså®¢æˆ·ç«¯åˆ›å»ºæˆåŠŸ: ${this.serverUrl}`);\n\n            // ç”Ÿæˆç©å®¶åç§°\n            if (!this.playerName || this.playerName.trim() === '') {\n                this.playerName = this.generateRandomName();\n            }\n\n            // åˆ›å»ºæˆ¿é—´\n            await this.createRoom();\n\n        } catch (error) {\n            console.error('[NetworkGameManager] ç½‘ç»œåˆå§‹åŒ–å¤±è´¥:', error);\n        }\n    }\n\n    /**\n     * åˆ›å»ºæˆ¿é—´\n     */\n    private async createRoom() {\n        try {\n            console.log(`[NetworkGameManager] æ­£åœ¨åˆ›å»ºæˆ¿é—´...`);\n            console.log(`[NetworkGameManager] ç©å®¶åç§°: ${this.playerName}`);\n            console.log(`[NetworkGameManager] è§’è‰²ç±»å‹: ${this.characterType}`);\n\n            this.room = await this.client.create(this.roomName, {\n                playerName: this.playerName,\n                characterType: this.characterType\n            });\n\n            this.localSessionId = this.room.sessionId;\n\n            console.log(`[NetworkGameManager] âœ… æˆ¿é—´åˆ›å»ºæˆåŠŸï¼`);\n            console.log(`[NetworkGameManager] æˆ¿é—´ID: ${this.room.id}`);\n            console.log(`[NetworkGameManager] ä¼šè¯ID: ${this.localSessionId}`);\n\n            // è®¾ç½®æˆ¿é—´äº‹ä»¶ç›‘å¬\n            this.setupRoomEvents();\n\n        } catch (error) {\n            console.error('[NetworkGameManager] åˆ›å»ºæˆ¿é—´å¤±è´¥:', error);\n        }\n    }\n\n    /**\n     * åŠ å…¥æˆ¿é—´\n     */\n    public async joinRoom(roomId: string) {\n        try {\n            console.log(`[NetworkGameManager] æ­£åœ¨åŠ å…¥æˆ¿é—´: ${roomId}`);\n\n            this.room = await this.client.joinById(roomId, {\n                playerName: this.playerName,\n                characterType: this.characterType\n            });\n\n            this.localSessionId = this.room.sessionId;\n\n            console.log(`[NetworkGameManager] âœ… åŠ å…¥æˆ¿é—´æˆåŠŸï¼`);\n            console.log(`[NetworkGameManager] æˆ¿é—´ID: ${this.room.id}`);\n            console.log(`[NetworkGameManager] ä¼šè¯ID: ${this.localSessionId}`);\n\n            this.setupRoomEvents();\n\n        } catch (error) {\n            console.error('[NetworkGameManager] åŠ å…¥æˆ¿é—´å¤±è´¥:', error);\n        }\n    }\n\n    /**\n     * è®¾ç½®æˆ¿é—´äº‹ä»¶ç›‘å¬\n     */\n    private setupRoomEvents() {\n        if (!this.room) return;\n\n        // ç©å®¶åŠ å…¥\n        this.room.state.players.onAdd((player: any, sessionId: string) => {\n            console.log(`[NetworkGameManager] ğŸ‘¤ ç©å®¶åŠ å…¥: ${player.name} (${sessionId})`);\n            this.onPlayerJoined(player, sessionId);\n        });\n\n        // ç©å®¶ç¦»å¼€\n        this.room.state.players.onRemove((player: any, sessionId: string) => {\n            console.log(`[NetworkGameManager] ğŸ‘‹ ç©å®¶ç¦»å¼€: ${player.name} (${sessionId})`);\n            this.onPlayerLeft(player, sessionId);\n        });\n\n        // ç©å®¶çŠ¶æ€å˜åŒ–\n        this.room.state.players.onAdd((player: any, sessionId: string) => {\n            player.onChange(() => {\n                this.onPlayerStateChanged(player, sessionId);\n            });\n        });\n\n        // ç›‘å¬è‡ªå®šä¹‰æ¶ˆæ¯\n        this.setupCustomMessages();\n    }\n\n    /**\n     * è®¾ç½®è‡ªå®šä¹‰æ¶ˆæ¯ç›‘å¬ï¼ˆä»»åŠ¡4.2-4.4ï¼‰\n     */\n    private setupCustomMessages() {\n        if (!this.room) return;\n\n        // çŸ¿çŸ³æ”¶é›†äº‹ä»¶\n        this.room.onMessage('oreCollected', (message: any) => {\n            console.log('[NetworkGameManager] ğŸ“¦ çŸ¿çŸ³è¢«æ”¶é›†:', message);\n            this.onOreCollectedNetwork(message);\n        });\n\n        // ç©å®¶è¢«æŠ“äº‹ä»¶\n        this.room.onMessage('playerCaptured', (message: any) => {\n            console.log('[NetworkGameManager] ğŸ¯ ç©å®¶è¢«æŠ“:', message);\n            this.onPlayerCapturedNetwork(message);\n        });\n\n        // ç©å®¶è¢«æŒ‚èµ·äº‹ä»¶\n        this.room.onMessage('playerHanged', (message: any) => {\n            console.log('[NetworkGameManager] ğŸª ç©å®¶è¢«æŒ‚èµ·:', message);\n            this.onPlayerHangedNetwork(message);\n        });\n\n        // ç©å®¶è¢«æ•‘æ´äº‹ä»¶\n        this.room.onMessage('playerRescued', (message: any) => {\n            console.log('[NetworkGameManager] ğŸ†˜ ç©å®¶è¢«æ•‘æ´:', message);\n            this.onPlayerRescuedNetwork(message);\n        });\n\n        // ç©å®¶é€ƒè„±äº‹ä»¶\n        this.room.onMessage('playerEscaped', (message: any) => {\n            console.log('[NetworkGameManager] ğŸšª ç©å®¶é€ƒè„±:', message);\n            this.onPlayerEscapedNetwork(message);\n        });\n\n        // æ¸¸æˆç»“æŸäº‹ä»¶\n        this.room.onMessage('gameOver', (message: any) => {\n            console.log('[NetworkGameManager] ğŸ æ¸¸æˆç»“æŸ:', message);\n            this.onGameOverNetwork(message);\n        });\n    }\n\n    // ============ ç½‘ç»œäº‹ä»¶å›è°ƒ ============\n\n    private onPlayerJoined(player: any, sessionId: string) {\n        // TODO: åˆ›å»ºè¿œç¨‹ç©å®¶\n    }\n\n    private onPlayerLeft(player: any, sessionId: string) {\n        // TODO: é”€æ¯è¿œç¨‹ç©å®¶\n    }\n\n    private onPlayerStateChanged(player: any, sessionId: string) {\n        // TODO: æ›´æ–°è¿œç¨‹ç©å®¶çŠ¶æ€\n    }\n\n    private onOreCollectedNetwork(message: any) {\n        // TODO: åŒæ­¥çŸ¿çŸ³æ”¶é›†\n    }\n\n    private onPlayerCapturedNetwork(message: any) {\n        // TODO: åŒæ­¥ç©å®¶è¢«æŠ“\n    }\n\n    private onPlayerHangedNetwork(message: any) {\n        // TODO: åŒæ­¥ç©å®¶è¢«æŒ‚èµ·\n    }\n\n    private onPlayerRescuedNetwork(message: any) {\n        // TODO: åŒæ­¥ç©å®¶è¢«æ•‘æ´\n    }\n\n    private onPlayerEscapedNetwork(message: any) {\n        // TODO: åŒæ­¥ç©å®¶é€ƒè„±\n    }\n\n    private onGameOverNetwork(message: any) {\n        // TODO: åŒæ­¥æ¸¸æˆç»“æŸ\n    }\n\n    // ============ å‘é€ç½‘ç»œæ¶ˆæ¯ ============\n\n    /**\n     * å‘é€ç©å®¶ç§»åŠ¨\n     */\n    public sendPlayerMove(x: number, y: number, z: number, rotationY: number, isMoving: boolean, animationState: string) {\n        if (!this.room) return;\n\n        this.room.send('playerMove', {\n            x, y, z,\n            rotationY,\n            isMoving,\n            animationState,\n            timestamp: Date.now()\n        });\n    }\n\n    /**\n     * å‘é€çŸ¿çŸ³æ”¶é›†\n     */\n    public sendOreCollected(oreId: string) {\n        if (!this.room) return;\n\n        this.room.send('oreCollected', {\n            oreId,\n            sessionId: this.localSessionId,\n            timestamp: Date.now()\n        });\n    }\n\n    /**\n     * å‘é€ç©å®¶è¢«æŠ“\n     */\n    public sendPlayerCaptured(targetSessionId: string) {\n        if (!this.room) return;\n\n        this.room.send('playerCaptured', {\n            hunterSessionId: this.localSessionId,\n            targetSessionId,\n            timestamp: Date.now()\n        });\n    }\n\n    /**\n     * å‘é€ç©å®¶è¢«æŒ‚èµ·\n     */\n    public sendPlayerHanged(targetSessionId: string, cageId: string) {\n        if (!this.room) return;\n\n        this.room.send('playerHanged', {\n            hunterSessionId: this.localSessionId,\n            targetSessionId,\n            cageId,\n            timestamp: Date.now()\n        });\n    }\n\n    /**\n     * å‘é€ç©å®¶è¢«æ•‘æ´\n     */\n    public sendPlayerRescued(rescuerSessionId: string, targetSessionId: string) {\n        if (!this.room) return;\n\n        this.room.send('playerRescued', {\n            rescuerSessionId,\n            targetSessionId,\n            timestamp: Date.now()\n        });\n    }\n\n    /**\n     * å‘é€ç©å®¶é€ƒè„±\n     */\n    public sendPlayerEscaped(sessionId: string) {\n        if (!this.room) return;\n\n        this.room.send('playerEscaped', {\n            sessionId,\n            timestamp: Date.now()\n        });\n    }\n\n    // ============ å·¥å…·æ–¹æ³• ============\n\n    /**\n     * ç”Ÿæˆéšæœºç©å®¶åç§°\n     */\n    private generateRandomName(): string {\n        const adjectives = ['å¿«ä¹', 'å‹‡æ•¢', 'èªæ˜', 'å¯çˆ±', 'ç¥ç§˜', 'å¼ºå¤§', 'çµæ´»', 'ç‹¡çŒ¾'];\n        const nouns = ['å°çŒ«', 'å°ç‹—', 'å°å…”', 'å°ç†Š', 'å°é¸Ÿ', 'å°é±¼', 'å°ç‹¼', 'å°è™'];\n        const adj = adjectives[Math.floor(Math.random() * adjectives.length)];\n        const noun = nouns[Math.floor(Math.random() * nouns.length)];\n        const num = Math.floor(Math.random() * 100);\n        return `${adj}çš„${noun}${num}`;\n    }\n\n    /**\n     * è·å–æˆ¿é—´ID\n     */\n    public getRoomId(): string {\n        return this.room ? this.room.id : '';\n    }\n\n    /**\n     * è·å–æœ¬åœ°ä¼šè¯ID\n     */\n    public getLocalSessionId(): string {\n        return this.localSessionId;\n    }\n\n    /**\n     * æ˜¯å¦å·²è¿æ¥\n     */\n    public isConnected(): boolean {\n        return this.room !== null;\n    }\n\n    /**\n     * è·å–ç©å®¶æ•°é‡\n     */\n    public getPlayerCount(): number {\n        return this.room ? this.room.state.players.size : 0;\n    }\n\n    // ============ å•ä¾‹è®¿é—® ============\n\n    public static getInstance(): NetworkGameManager | null {\n        return NetworkGameManager._instance;\n    }\n\n    onDestroy() {\n        if (NetworkGameManager._instance === this) {\n            NetworkGameManager._instance = null;\n        }\n\n        // ç¦»å¼€æˆ¿é—´\n        if (this.room) {\n            this.room.leave();\n            this.room = null;\n        }\n    }\n}\n"]}