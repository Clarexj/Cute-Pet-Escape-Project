# 任务2.1 配置指南 - 抓捕、挂起、救援、淘汰系统

**版本：** V1.0
**完成时间：** 2025-10-01
**功能：** 完整的抓捕、挂起、救援、淘汰逻辑

---

## 📋 功能说明

任务2.1实现了完整的核心玩法循环：

1. **角色状态管理**：Normal → Caught → Hanged → Eliminated
2. **追捕者抓捕**：碰撞检测自动抓捕逃生者
3. **挂起系统**：30秒倒计时，生命值管理（2条命）
4. **救援系统**：3秒读条，显示进度条
5. **淘汰逻辑**：倒计时结束或生命耗尽

---

## 🎯 第一步：准备工作

### 1. 确认文件已更新

所有脚本已创建/更新到以下位置：

```
CocosProject/NewProject/assets/scripts/
├── CharacterState.ts（新增）- 角色状态管理
├── Hunter.ts（新增）- 追捕者原型
├── Cage.ts（新增）- 笼子组件
├── PlayerController.ts（V1.3）- 新增救援系统
├── InteractionUI.ts（V1.1）- 新增救援UI
└── ...（之前的文件）
```

### 2. 打开Cocos Creator项目

1. 启动 **Cocos Creator 3.x**
2. 打开项目文件夹：
   ```
   /Users/clare/Desktop/前哨AI小课/ClareProject/Cute-Pet-Escape-Project/CocosProject/NewProject
   ```

---

## 🛠️ 第二步：配置逃生者

### 1. 给逃生者添加CharacterState组件

1. 选中场景中的 **Player** 节点
2. 在 **属性检查器** 底部点击 **添加组件**
3. 选择 **自定义脚本** → **CharacterState**

### 2. 配置CharacterState参数

在属性检查器中设置：

```
Max Hang Count: 2（最多被挂起2次，即2条命）
Hang Duration: 30.0（挂起倒计时30秒）
Rescue Duration: 3.0（救援读条3秒）
```

### 3. 确认PlayerController配置

选中 Player 节点，确认 **PlayerController** 组件有以下参数：

```
Joystick: [已绑定]
Camera Node: [已绑定]
Move Speed: 5.0
Rotation Speed: 10.0
Interact Distance: 2.5
Rescue Distance: 2.0（新增）
```

---

## 🛠️ 第三步：创建追捕者（红色Cube）

### 1. 创建追捕者节点

1. 在 **层级管理器** 中右键 → **创建** → **3D对象** → **立方体（Cube）**
2. 重命名为 `Hunter`

### 2. 设置追捕者外观

选中 Hunter 节点，在 **属性检查器** 中：

**Transform**：
- Position: `(0, 0.5, -5)`（玩家前方）
- Scale: `(1, 2, 1)`（高一点，像个人）

**MeshRenderer** → **Material**：
- 新建材质或修改颜色为 **红色**（用于区分追捕者）

### 3. 添加BoxCollider（碰撞检测）

1. 选中 Hunter 节点
2. 添加组件 → **Physics** → **BoxCollider**
3. 配置BoxCollider：
   ```
   Is Trigger: ✓（勾选，触发器模式）
   Center: (0, 0, 0)
   Size: (1, 2, 1)
   ```

### 4. 添加Hunter脚本

1. 添加组件 → **自定义脚本** → **Hunter**
2. 配置参数：
   ```
   Move Speed: 5.75（115% = 5 * 1.15）
   Catch Range: 1.5
   Auto Catch Enabled: ✓（勾选，自动抓捕）
   ```

---

## 🛠️ 第四步：创建笼子（黄色Cube）

### 1. 创建笼子节点

1. 在层级管理器中右键 → 创建 → 3D对象 → 立方体
2. 重命名为 `Cage1`

### 2. 设置笼子外观

选中 Cage1 节点：

**Transform**：
- Position: `(10, 1, 0)`（场景一侧）
- Scale: `(2, 3, 2)`（较大的笼子）

**MeshRenderer** → **Material**：
- 修改颜色为 **黄色**（用于区分笼子）

### 3. 添加Cage脚本

1. 添加组件 → 自定义脚本 → **Cage**
2. 配置参数：
   ```
   Max Capacity: 1（最多挂起1个逃生者）
   ```

---

## 🛠️ 第五步：配置救援UI

### 1. 创建救援进度条（可选）

如果需要显示救援进度条：

1. 找到Canvas下的 **InteractionButton** 节点
2. 在InteractionButton下创建子节点 → UI组件 → **ProgressBar**
3. 重命名为 `RescueProgressBar`

### 2. 配置进度条

选中 RescueProgressBar：

**UITransform**：
- Content Size: Width=150, Height=20
- Position: Y=-80（按钮下方）

**ProgressBar**：
- Mode: FILLED
- Total Length: 1.0
- Progress: 0

### 3. 更新InteractionUI配置

选中 InteractionButton 节点，在 **InteractionUI** 组件中：

```
Player: [拖入Player节点]
Button Node: [拖入InteractionButton自己]
Prompt Label: [拖入Label子节点]
Rescue Progress Bar: [拖入RescueProgressBar节点]（新增）
Fade Duration: 0.2
```

---

## ✅ 第六步：测试

### 1. 运行场景

点击编辑器顶部的 **▶️ 运行** 按钮

### 2. 测试清单

#### 基础测试
- [ ] 逃生者可以正常移动
- [ ] 追捕者（红色Cube）存在于场景中
- [ ] 笼子（黄色Cube）存在于场景中

#### 抓捕测试
- [ ] 靠近追捕者（自动抓捕）
- [ ] 逃生者状态变为 **Caught**（被抓）
- [ ] 逃生者跟随追捕者移动（成为追捕者子节点）
- [ ] 逃生者 **无法移动**
- [ ] 控制台输出：`[Hunter] 抓住了 Player`

#### 挂起测试
- [ ] 追捕者携带逃生者靠近笼子
- [ ] 逃生者被挂在笼子上（成为笼子子节点）
- [ ] 逃生者状态变为 **Hanged**（被挂起）
- [ ] 开始30秒倒计时
- [ ] 控制台输出：`[CharacterState] Player 被挂起（第1次），倒计时30秒`

#### 救援测试（需要多个逃生者）

**准备：** 复制Player节点创建Player2

1. **开始救援**：
   - [ ] 用另一个逃生者靠近被挂起的队友（2米内）
   - [ ] 右下角显示 **"救援"** 按钮
   - [ ] 点击按钮，开始救援
   - [ ] 救援者 **无法移动**
   - [ ] 显示救援进度条（0% → 100%）
   - [ ] 控制台输出：`[PlayerController] 开始救援 Player`

2. **救援成功**：
   - [ ] 3秒后救援完成
   - [ ] 被救的逃生者状态恢复为 **Normal**
   - [ ] 被救的逃生者从笼子上移回地面
   - [ ] 救援者可以移动
   - [ ] 救援按钮消失
   - [ ] 控制台输出：`[CharacterState] Player2 成功救援 Player`

3. **救援中断**（离开范围）：
   - [ ] 救援过程中移开救援者
   - [ ] 救援进度条消失
   - [ ] 被救者继续挂起状态
   - [ ] 救援者恢复移动
   - [ ] 控制台输出：`[CharacterState] Player 的救援被中断`

#### 淘汰测试

1. **倒计时淘汰**：
   - [ ] 被挂起后等待30秒
   - [ ] 逃生者状态变为 **Eliminated**
   - [ ] 逃生者节点隐藏（node.active = false）
   - [ ] 控制台输出：`[CharacterState] Player 挂起倒计时结束，淘汰`

2. **生命耗尽淘汰**：
   - [ ] 被抓并挂起2次（耗尽2条命）
   - [ ] 第2次被挂起时，倒计时结束后淘汰
   - [ ] 控制台显示挂起次数：`第1次` → `第2次`

---

## 🐛 常见问题

### 1. 追捕者无法抓捕逃生者

**原因1**：BoxCollider未设置为触发器

**解决方法**：
1. 选中Hunter节点
2. 检查BoxCollider组件
3. 确认 **Is Trigger** 已勾选

**原因2**：物理引擎未启用

**解决方法**：
1. 菜单栏 → 项目 → 项目设置
2. 找到 **物理** 标签
3. 确认物理引擎已启用

### 2. 追捕者抓住逃生者后无法挂起

**原因**：笼子节点命名不对

**解决方法**：
1. 确认笼子节点名称包含"Cage"或"cage"
2. 或修改Hunter.ts的检测逻辑

### 3. 救援按钮不显示

**原因1**：InteractionUI未绑定RescueProgressBar

**解决方法**：
1. 选中InteractionButton节点
2. 检查InteractionUI组件
3. 将RescueProgressBar拖入对应字段

**原因2**：救援距离太近

**解决方法**：
1. 选中Player节点
2. 调大PlayerController的 **Rescue Distance** 参数

### 4. 救援完成后逃生者还在笼子上

**原因**：CharacterState的onRescueComplete逻辑问题

**解决方法**：
- 检查控制台是否有错误
- 确认CharacterState.ts是最新版本

### 5. 控制台报错：CharacterState组件未找到

**原因**：Player节点未添加CharacterState组件

**解决方法**：
1. 选中Player节点
2. 添加组件 → CharacterState

---

## 📊 技术说明

### 状态流转图

```
Normal（正常）
   ↓ 被追捕者抓住
Caught（被抓）
   ↓ 被挂在笼子上
Hanged（被挂起）
   ↓ 30秒倒计时 或 被救援
Eliminated（淘汰） / Normal（正常）
```

### 生命值机制

- 初始生命：2条命（maxHangCount = 2）
- 每次被挂起消耗1条命
- 被挂起2次后，第2次倒计时结束→淘汰
- 救援成功不消耗生命（挂起次数已记录）

### 救援机制

**开始救援**：
1. 救援者靠近（2米内）
2. UI显示"救援"按钮
3. 点击按钮→锁定救援者移动
4. 开始3秒读条

**救援成功**：
1. 3秒读条完成
2. 被救者状态→Normal
3. 被救者移回地面
4. 救援者解锁移动

**救援中断**：
1. 救援者移开（超出2米）
2. 进度重置
3. 救援者解锁移动

### 碰撞检测

Hunter使用BoxCollider（Is Trigger = true）：
- **onTriggerEnter**：进入范围→自动抓捕
- **onTriggerStay**：持续碰撞
- **onTriggerExit**：离开范围

---

## 🎮 高级配置

### 调整倒计时时长

选中Player节点，CharacterState组件：
```
Hang Duration: 30.0（默认30秒）
可调整为60.0（1分钟）或15.0（15秒，快速测试）
```

### 调整救援时长

```
Rescue Duration: 3.0（默认3秒）
可调整为5.0（5秒，更难）或1.0（1秒，快速测试）
```

### 调整生命值

```
Max Hang Count: 2（默认2条命）
可调整为3（3条命）或1（1条命，一击淘汰）
```

### 调整追捕者速度

选中Hunter节点：
```
Move Speed: 5.75（115% = 5 * 1.15）
可调整为6.0（120%，更快）或5.0（100%，测试用）
```

### 禁用自动抓捕（手动测试）

选中Hunter节点：
```
Auto Catch Enabled: 取消勾选
```

然后在代码中手动调用：
```javascript
hunter.manualCatch(playerNode);
hunter.manualHang(cageNode);
```

---

## 📁 文件清单

### 新增脚本（3个）

```
CocosProject/NewProject/assets/scripts/
├── CharacterState.ts（新增）
│   ├── 状态管理：Normal/Caught/Hanged/Eliminated
│   ├── 挂起倒计时（30秒）
│   ├── 救援进度（3秒）
│   ├── 生命值管理（2条命）
│   └── 状态变化回调
│
├── Hunter.ts（新增）
│   ├── 追捕者AI
│   ├── 碰撞检测自动抓捕
│   ├── 靠近笼子自动挂起
│   └── 手动控制接口
│
└── Cage.ts（新增）
    ├── 笼子容量管理
    ├── 挂起逃生者列表
    └── 状态监听
```

### 更新脚本（2个）

```
├── PlayerController.ts（V1.2 → V1.3）
│   ├── 新增：状态检测（只有Normal才能移动）
│   ├── 新增：救援目标检测
│   ├── 新增：触发救援方法
│   └── 新增：救援回调系统
│
└── InteractionUI.ts（V1.0 → V1.1）
    ├── 新增：救援模式切换
    ├── 新增：救援进度条显示
    └── 新增：救援按钮点击处理
```

---

## 🎉 完成！

如果所有测试通过，任务2.1完成！

**当前进度：**
- ✅ 任务1.1：虚拟摇杆移动
- ✅ 任务1.2：摄像机旋转
- ✅ 任务1.3：交互系统（推倒木板 + 拾取矿石）
- ✅ 任务2.1：抓捕、挂起、救援、淘汰逻辑

**下一步：**
- 任务2.2：追捕者完整玩法 + 游戏胜负流程
- 任务3.1：角色模型与动画
- 任务3.2：核心UI界面(HUD)

---

## 📄 相关文档

- **快速开始-任务2.1.md** - 5分钟快速配置
- **任务1.1-1.3完整验收报告.md** - 之前的验收报告
- **GAME_DESIGN_DOCUMENT.md** - 游戏设计文档
- **DELIVERY_CHECKLIST.md** - 验收清单

---

有任何问题请随时告诉我！🚀
