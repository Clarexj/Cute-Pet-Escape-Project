# 环境互动脚本与自测指引

本指南汇总 `branch_env_interaction` 目录下与《代号：萌宠大逃亡》环境互动相关的脚本改动，并给出不依赖引擎的快速验证方式。

## 核心脚本改动
- **Board.ts**
  - 倒地后会启用阻挡碰撞并检测追捕者，命中则触发 1.5 秒眩晕。
  - 追捕者踩碎木板改为 2.5 秒读条流程，支持中断、取消与进度回调。
- **HunterController.ts / HunterUI.ts**
  - 新增眩晕状态管理，禁止攻击、移动及破坏动作。
  - 踩板流程暴露开始 / 进度 / 取消事件，UI 按钮实时显示百分比并可取消。
- **Cabinet.ts**
  - 新增储物柜交互，逃生者可躲藏，追捕者可强制开柜，离开时重置位置。

> 将上述脚本替换主工程同名文件，即可体验新版环境互动闭环。

## Node.js 快速自测脚本
无需安装 Cocos 引擎即可验证交互逻辑：

```bash
node branch_env_interaction/tests/run_tests.js
```

如遇执行权限限制，可先运行：

```bash
chmod +x branch_env_interaction/tests/run_tests.js
```

脚本会依序输出 4 个场景的结果：

| 场景 | 对应的 GDD 要求 |
| --- | --- |
| 木板倒下眩晕判定 | 木板倒下需要眩晕倒下区域内的追捕者，并切换为阻挡状态 |
| 追捕者踩碎木板流程 | 倒下的木板需要被追捕者通过持续互动踩碎，期间提供进度反馈 |
| 破坏被中断的恢复 | 玩家打断或追捕者离开时，需要停止破坏并重置进度 |
| 柜子潜入与拉出流程 | 幸存者可潜入柜子，存在冷却时间，追捕者可强制拖出 |

全部场景通过时进程退出码为 0，方便集成自动化校验。

## 扩展测试
可以根据 `branch_env_interaction/tests/run_tests.js` 的写法新增场景：
1. 在 `scenarios` 数组中追加新的异步函数。
2. 使用 `simulations/` 下的辅助类构造角色与交互对象。
3. 在完成后输出 `summary`，方便策划核对时间线。

如需补充其它环境互动，请在提交前更新本文件以及 GDD 对应章节，保持脚本与文档同步。
