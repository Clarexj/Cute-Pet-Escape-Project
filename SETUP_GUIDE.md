# 任务1.1 配置指南 - 虚拟摇杆移动系统

## 📋 准备工作

确保你已经：
- ✅ 安装了 Cocos Creator 3.x（建议3.8或更高版本）
- ✅ 创建了新的 3D 项目
- ✅ 将 `scripts` 文件夹中的3个脚本导入到项目中

---

## 🎬 第一步：创建场景基础

### 1. 创建场景
1. 在 Cocos Creator 中，点击 **资源管理器** -> 右键 -> **新建** -> **Scene**
2. 命名为 `GameScene`
3. 双击打开场景

### 2. 创建地面（Plane）
1. 在 **层级管理器** 中，右键 -> **创建** -> **3D对象** -> **Plane（平面）**
2. 命名为 `Ground`
3. 在 **属性检查器** 中设置：
   - **Position**: `(0, 0, 0)`
   - **Scale**: `(10, 1, 10)` ← 放大10倍作为地面

### 3. 创建玩家角色（Capsule）
1. 在 **层级管理器** 中，右键 -> **创建** -> **3D对象** -> **Capsule（胶囊体）**
2. 命名为 `Player`
3. 在 **属性检查器** 中设置：
   - **Position**: `(0, 1, 0)` ← 注意Y轴为1，让角色站在地面上
   - **Rotation**: `(0, 0, 0)`
   - **Scale**: `(1, 1, 1)`

### 4. 添加碰撞组件（可选，为后续准备）
1. 选中 `Player` 节点
2. 在 **属性检查器** 底部点击 **添加组件** -> **Physics** -> **Colliders** -> **CapsuleCollider**
3. 参数保持默认即可

> **注意**：暂时不需要添加 RigidBody，我们使用 Transform 控制移动更简单稳定。

---

## 🎮 第二步：创建虚拟摇杆UI

### 1. 创建Canvas（画布）
1. 在 **层级管理器** 中，右键 -> **创建** -> **UI** -> **Canvas**
2. Canvas会自动创建，展开它查看子节点

### 2. 创建摇杆背景
1. 右键点击 `Canvas` -> **创建** -> **UI** -> **Sprite（精灵）**
2. 命名为 `JoystickBase`
3. 在 **属性检查器** 中设置：
   - **Position**: `(-400, -200, 0)` ← 放在屏幕左下角
   - **Width**: `200`
   - **Height**: `200`
   - **Color**: 灰色（RGB: 128, 128, 128, 100） ← 半透明

### 3. 创建摇杆中心点
1. 右键点击 `JoystickBase` -> **创建** -> **UI** -> **Sprite（精灵）**
2. 命名为 `JoystickStick`
3. 在 **属性检查器** 中设置：
   - **Position**: `(0, 0, 0)` ← 相对父节点居中
   - **Width**: `80`
   - **Height**: `80`
   - **Color**: 白色（RGB: 255, 255, 255, 200）

---

## 🔗 第三步：绑定脚本

### 1. 给摇杆添加 Joystick 脚本
1. 选中 `JoystickBase` 节点
2. 在 **属性检查器** 底部点击 **添加组件** -> **自定义脚本** -> **Joystick**
3. 在脚本组件中：
   - 将 `JoystickStick` 节点拖到 **Stick** 属性框中
   - **Max Radius** 设置为 `100`

### 2. 给玩家添加 PlayerController 脚本
1. 选中 `Player` 节点
2. 在 **属性检查器** 底部点击 **添加组件** -> **自定义脚本** -> **PlayerController**
3. 在脚本组件中：
   - 将 `JoystickBase` 节点拖到 **Joystick** 属性框中
   - 将 `Main Camera` 节点拖到 **Camera Node** 属性框中
   - **Move Speed** 保持默认 `5`
   - **Rotation Speed** 保持默认 `10`

### 3. 给摄像机添加 CameraFollow 脚本
1. 选中 `Main Camera` 节点
2. 在 **属性检查器** 底部点击 **添加组件** -> **自定义脚本** -> **CameraFollow**
3. 在脚本组件中：
   - 将 `Player` 节点拖到 **Target** 属性框中
   - **Follow Distance** 设置为 `8`
   - **Follow Height** 设置为 `5`
   - **Look At Height** 设置为 `1`
   - **Smooth Speed** 设置为 `5`
   - **Pitch Angle** 设置为 `30`

---

## ▶️ 第四步：测试运行

### 1. 运行场景
1. 点击编辑器顶部的 **播放按钮**（三角形图标）
2. 场景会在浏览器中打开

### 2. 测试功能
- ✅ 看到灰色的摇杆在屏幕左下角
- ✅ 拖动摇杆，白色中心点会跟随移动
- ✅ 胶囊体角色会根据摇杆方向移动
- ✅ 角色移动时会转向面对移动方向
- ✅ 摄像机会跟随角色移动

### 3. 常见问题排查

**问题1：摇杆没反应**
- 检查 `JoystickBase` 的 `Joystick` 脚本中，`Stick` 属性是否正确绑定了 `JoystickStick` 节点

**问题2：角色不移动**
- 检查 `Player` 的 `PlayerController` 脚本中：
  - `Joystick` 属性是否绑定了 `JoystickBase` 节点
  - `Camera Node` 属性是否绑定了 `Main Camera` 节点

**问题3：摄像机不跟随**
- 检查 `Main Camera` 的 `CameraFollow` 脚本中，`Target` 属性是否绑定了 `Player` 节点

**问题4：移动方向不对**
- 确保 `PlayerController` 的 `Camera Node` 绑定的是 `Main Camera`
- 检查摄像机的初始位置是否在角色后上方

---

## 🎯 验收标准（对照交付清单）

根据 `DELIVERY_CHECKLIST.md` 模块一：

- [x] 程序可正常启动和退出，无崩溃
- [x] 摇杆操控：上/下/左/右/斜向移动，与预期方向完全一致
- [x] 角色移动：无卡顿、漂移、穿墙或被空气墙阻挡的现象
- [ ] 镜头控制：拖动屏幕可平滑旋转视角（任务1.2实现）
- [ ] 游戏设置：提前退出游戏的按钮（后续实现）

---

## 📌 参数调优建议

如果觉得移动效果不理想，可以调整以下参数：

### PlayerController（角色控制）
- **Move Speed**：数值越大移动越快（建议范围：3-10）
- **Rotation Speed**：数值越大转身越快（建议范围：5-15）

### CameraFollow（摄像机）
- **Follow Distance**：摄像机距离角色的距离（建议范围：5-12）
- **Follow Height**：摄像机高度（建议范围：3-8）
- **Pitch Angle**：俯视角度（建议范围：20-45度）
- **Smooth Speed**：跟随平滑度，数值越小越平滑但有延迟（建议范围：3-8）

### Joystick（摇杆）
- **Max Radius**：摇杆最大拖动范围（建议范围：80-120）

---

## 🚀 下一步（任务1.2预告）

当前系统已经为任务1.2"实现可拖拽的镜头转动"预留了接口：
- `CameraFollow.ts` 中的 `calculateTargetOffset()` 方法可以轻松添加水平旋转
- 只需要添加一个新的输入检测脚本来控制摄像机的水平角度

---

## 💡 技术说明

### 为什么用 Transform 而不是 RigidBody？
1. **更可控**：直接控制位置，不会有物理引擎的"惊喜"（滑行、翻滚等）
2. **更简单**：代码量少50%，调试容易
3. **性能更好**：不需要物理计算
4. **够用**：对于这个游戏的移动需求完全满足

后续如果需要真实的物理交互（如被撞飞），可以轻松升级为物理驱动。

### 移动方向计算原理
- 摇杆输入是2D的（X轴左右，Y轴上下）
- 通过摄像机的朝向，将2D输入转换为3D世界空间方向
- 这样无论摄像机朝向哪里，摇杆"向上"总是向屏幕前方移动

### 摄像机跟随策略
- 使用 `lateUpdate()` 确保在角色移动后再更新摄像机
- 使用插值平滑跟随，避免抖动
- 固定在角色后上方，为任务1.2的自由旋转预留空间
