# 任务1.3 配置指南 - 交互系统

**版本：** V1.0
**完成时间：** 2025-10-01
**功能：** 推倒木板 + 拾取矿石

---

## 📋 功能说明

任务1.3实现了通用的交互系统：

1. **距离检测**：玩家靠近可交互物体时，自动检测
2. **UI按钮**：右下角显示交互按钮，点击触发交互
3. **木板交互**：Cube旋转90度倒下（1秒动画）
4. **矿石交互**：Sphere放大漂浮后消失

---

## 🎯 第一步：准备工作

### 1. 确认文件已更新

所有脚本已创建/更新到以下位置：

```
CocosProject/NewProject/assets/scripts/
├── Interactable.ts（新增）- 交互基类
├── Board.ts（新增）- 木板交互
├── Ore.ts（新增）- 矿石交互
├── InteractionUI.ts（新增）- 交互UI
├── PlayerController.ts（V1.2）- 新增交互检测
├── Joystick.ts（V1.1）
├── CameraFollow.ts（V1.1）
└── CameraController.ts（V1.0）
```

### 2. 打开Cocos Creator项目

1. 启动 **Cocos Creator 3.x**
2. 打开项目文件夹：
   ```
   /Users/clare/Desktop/前哨AI小课/ClareProject/Cute-Pet-Escape-Project/CocosProject/NewProject
   ```
3. 等待资源加载完成

---

## 🛠️ 第二步：创建3D场景物体

### 1. 创建木板（Cube）

1. 在 **层级管理器** 中右键 → **创建** → **3D对象** → **立方体（Cube）**
2. 重命名为 `Board1`
3. 在 **属性检查器** 中设置：
   - **Position**：X=3, Y=1, Z=2（玩家前方）
   - **Rotation**：X=0, Y=0, Z=0
   - **Scale**：X=0.5, Y=2, Z=2（竖立的木板形状）

### 2. 创建矿石（Sphere）

1. 在 **层级管理器** 中右键 → **创建** → **3D对象** → **球体（Sphere）**
2. 重命名为 `Ore1`
3. 在 **属性检查器** 中设置：
   - **Position**：X=-3, Y=0.5, Z=2（玩家前方另一侧）
   - **Rotation**：X=0, Y=0, Z=0
   - **Scale**：X=0.5, Y=0.5, Z=0.5（较小的矿石）

---

## 🔧 第三步：添加交互脚本

### 1. 给木板添加Board脚本

1. 选中 `Board1` 节点
2. 在 **属性检查器** 底部点击 **添加组件**
3. 选择 **自定义脚本** → **Board**
4. 配置参数：
   - **Interact Range**：2.0（交互范围2米）
   - **Interact Prompt**："推倒木板"
   - **Fall Duration**：1.0（倒下动画1秒）
   - **Fall Direction**：X=0, Y=0, Z=1（向前倒）

### 2. 给矿石添加Ore脚本

1. 选中 `Ore1` 节点
2. 在 **属性检查器** 底部点击 **添加组件**
3. 选择 **自定义脚本** → **Ore**
4. 配置参数：
   - **Interact Range**：2.0（交互范围2米）
   - **Interact Prompt**："拾取矿石"
   - **Collect Duration**：0.3（拾取动画0.3秒）
   - **Collect Scale Up**：1.5（放大1.5倍）
   - **Float Up Distance**：1.0（向上漂浮1米）

---

## 🎮 第四步：配置交互UI

### 1. 创建交互按钮

1. 找到 **Canvas** 节点（应该已经存在）
2. 在Canvas下右键 → **创建** → **UI组件** → **Button**
3. 重命名为 `InteractionButton`

### 2. 设置按钮位置和大小

选中 `InteractionButton`，在 **属性检查器** 中：

1. **UITransform** 组件：
   - **Content Size**：Width=150, Height=150
   - **Anchor Preset**：右下角（点击右下角锚点）
   - **Position**：X=-100, Y=100（右下角位置）

2. **Button** 组件：
   - **Transition**：COLOR（颜色过渡）
   - **Normal Color**：白色，透明度255
   - **Pressed Color**：灰色，透明度200

### 3. 添加按钮文本

1. 选中 `InteractionButton` 下的 **Label** 子节点
2. 在 **属性检查器** 中设置：
   - **Label** 组件：
     - **String**："交互"
     - **Font Size**：40
     - **Color**：黑色

### 4. 给按钮添加InteractionUI脚本

1. 选中 `InteractionButton` 节点（不是Label，是Button本身）
2. 在 **属性检查器** 底部点击 **添加组件**
3. 选择 **自定义脚本** → **InteractionUI**
4. 配置参数：
   - **Player**：拖入Player节点（场景中的Player）
   - **Button Node**：拖入自己（InteractionButton）
   - **Prompt Label**：拖入Label子节点（可选）
   - **Fade Duration**：0.2（淡入淡出0.2秒）

---

## 🔗 第五步：配置PlayerController

### 1. 更新Player的脚本引用

1. 选中 **Player** 节点
2. 在 **属性检查器** 中找到 **PlayerController** 组件
3. 确认以下参数：
   - **Joystick**：已绑定Joystick组件
   - **Camera Node**：已绑定Main Camera节点
   - **Move Speed**：5.0
   - **Rotation Speed**：10.0
   - **Interact Distance**：2.5（新增参数）

---

## ✅ 第六步：测试

### 1. 运行场景

1. 点击编辑器顶部的 **▶️ 运行** 按钮
2. 浏览器会自动打开游戏

### 2. 测试清单

#### 基础功能测试
- [ ] 左侧摇杆可以控制角色移动
- [ ] 右侧拖拽可以旋转摄像机
- [ ] 角色移动方向相对于摄像机

#### 交互系统测试（最重要！）
- [ ] 靠近木板（2米内），右下角出现"推倒木板"按钮
- [ ] 点击按钮，木板旋转90度倒下（1秒动画）
- [ ] 远离木板，按钮消失
- [ ] 靠近矿石（2米内），右下角出现"拾取矿石"按钮
- [ ] 点击按钮，矿石放大漂浮后消失
- [ ] 矿石消失后，按钮消失

#### 边界情况测试
- [ ] 木板倒下后，不能再次交互
- [ ] 矿石消失后，不能再次拾取
- [ ] 同时靠近木板和矿石，只显示最近的一个
- [ ] 按钮淡入淡出动画流畅

---

## 🐛 常见问题

### 1. 按钮一直显示/不显示

**原因**：InteractionUI脚本的Player引用未绑定

**解决方法**：
1. 选中InteractionButton节点
2. 在InteractionUI组件中，将Player节点拖入Player字段

### 2. 点击按钮没有反应

**原因1**：Button组件的点击事件未触发

**检查方法**：
1. 打开浏览器控制台（F12）
2. 点击按钮，查看是否有日志输出

**原因2**：PlayerController引用丢失

**解决方法**：
1. 确认InteractionUI的Player字段已绑定
2. 确认Player节点上有PlayerController组件

### 3. 木板倒下方向不对

**原因**：Fall Direction参数设置不正确

**解决方法**：
1. 选中Board节点
2. 在Board组件中调整Fall Direction：
   - 向前倒：X=0, Y=0, Z=1
   - 向后倒：X=0, Y=0, Z=-1
   - 向右倒：X=1, Y=0, Z=0
   - 向左倒：X=-1, Y=0, Z=0

### 4. 检测距离太近/太远

**原因**：交互范围参数不匹配

**解决方法**：
1. 调整PlayerController的Interact Distance（全局检测距离）
2. 调整Interactable的Interact Range（单个物体范围）
3. 建议：PlayerController距离 >= Interactable距离

### 5. 按钮位置不对

**解决方法**：
1. 选中InteractionButton节点
2. 调整UITransform的Position参数
3. 确认Anchor锚点在右下角

---

## 📊 技术说明

### 交互检测原理

1. **距离检测**：PlayerController每帧遍历所有Interactable组件
2. **计算距离**：使用Vec3距离计算，找到最近的可交互物体
3. **回调通知**：距离变化时通知InteractionUI显示/隐藏按钮

### 性能优化

- **对象复用**：使用`_tempVec3_1/2`复用临时向量，避免GC
- **按需检测**：只在update中检测，不使用射线检测（性能更好）
- **单例选择**：同一时间只显示一个可交互物体

### 扩展性

可以轻松添加新的交互物体：

1. 创建新脚本，继承`Interactable`
2. 重写`onInteract()`方法实现交互逻辑
3. 在场景中添加节点并挂载脚本

示例：
```typescript
@ccclass('Door')
export class Door extends Interactable {
    protected onInteract(player: Node): void {
        console.log('开门！');
        // 门的开启动画
    }
}
```

---

## 🎉 完成！

如果所有测试通过，任务1.3完成！

**当前进度：**
- ✅ 任务1.1：虚拟摇杆移动
- ✅ 任务1.2：摄像机旋转
- ✅ 任务1.3：交互系统（推倒木板 + 拾取矿石）

**下一步：**
- 任务2.1：抓捕、挂起、救援、淘汰逻辑
- 任务2.2：追捕者玩法与胜负判定

---

## 📄 相关文档

- **任务1.1和1.2测试报告.md** - 之前的测试报告
- **代码检查报告.md** - 性能优化详情
- **GAME_DESIGN_DOCUMENT.md** - 完整游戏设计文档

---

有任何问题请随时告诉我！🚀
